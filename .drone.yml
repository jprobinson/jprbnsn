---
kind: pipeline
type: docker
name: default

steps:
- name: deploy
  image: nytimes/drone-gae:latest
  settings:
    action: deploy
    project: jprbnsn
    version: "${DRONE_COMMIT}"
    max_versions: 2
  environment:
    GAE_CREDENTIALS:
      from_secret: google_credentials
  when:
    branch: [master]

- name: dispatch:
  image: nytimes/drone-gae
  settings:
    action: update_dispatch
    project: jprbnsn
    dispatch_file: dispatch.yaml
    version: "${DRONE_COMMIT}"
  environment:
    GAE_CREDENTIALS:
      from_secret: google_credentials
  when:
    branch: master
